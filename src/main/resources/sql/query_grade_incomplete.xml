<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>DPS Incomplete Grades Queries</comment>
	
	<entry key="dps.incomplete.grade.select.course.list">
		<![CDATA[
				SELECT
				    DISTINCT
				       SECT.L_ABR_CRSNO												AS    	L_ABR_CRSNO
				    ,  SECT.CRSNO													AS		COURSE_NO
				    ,  DECODE (
					            :paramLocale
					            , 'ar', COURSE.A_CRSLNM
					            , COURSE.CRSLNM
					          )  													AS 		COURSE_NAME
				    , SECT.SECTNO													AS      SECTION_NO
				    , SECT.SECTCD                       							AS  	SECT_CODE
				    , SECT.CCYRCD                       							AS  	CCYRCD
            		, SECT.SEMCD                        							AS  	SEMCD
		FROM 
              		SECT          SECT
		        , 	SCHED_WEEKLY  SCHW
		        , 	FAC_SURNM     FACULTY
		        , 	CRS_BASIC     COURSE
		      
		WHERE
		              SECT.CCYRCD = :paramYear
		        AND   SECT.SEMCD = :paramSemester
        
		        AND   SCHW.SECTCD = SECT.SECTCD
		        
		        AND   SCHW.CRSNO  = SECT.CRSNO
		        AND   SCHW.SECTNO = SECT.SECTNO
		        
		        AND   SCHW.FACSURNMCD=FACULTY.FAC_SURNMCD
		        AND   FACULTY.EMPNO =:paramEmpNo
		        AND   COURSE.CRSNO  = SECT.CRSNO
		        AND   COURSE.CRSNO  = SCHW.CRSNO 
		        
		        ORDER BY L_ABR_CRSNO
		   ]]>	
	</entry>
	<entry key="dps.incomplete.grades.select.rule.test.current.year.sem">
			SELECT 
			        CCYRCD      													AS    CCYRCD
			      , SEMCD       													AS    SEMCD
			FROM
			      CURRENT_YR_SEM	
		</entry>
		<!-- TODO -->
		<entry key="dps.incomplete.grades.select.rule.grade.change.year.sem">
			SELECT 
			          NVL(CCYRCD, 0) 												AS 		CCYRCD
			        , NVL(SEMCD, 0) 												AS 		SEMCD
			FROM
			(
			    SELECT 
			            NULL AS CCYRCD
			          , NULL AS SEMCD
			    FROM
			          DUAL
			          
			    UNION
			    
			    SELECT 
			            CCYRCD
			          , SEMCD
			    FROM
			          YR_SEM
			    WHERE
			          SYSDATE BETWEEN SEMENDDTE AND SEMENDDTE+30
			)	
			WHERE  ROWNUM = 1
	    	ORDER BY CCYRCD DESC, SEMCD DESC
		</entry>
	<entry key="dps.incomplete.grades.select.students">
			SELECT  DISTINCT 
				 	ST.STD_ID                          								AS  	STUDENT_ID
	            ,	SI.STDNO                          								AS  	STUDENT_NO
	            ,	SI.STDSTATCD													AS		STDSTATCD
	            , 	DECODE
	                     (
	                       :paramLocale
	                        , 'en' ,SI.STD_NAME
	                        , A_STD_NAME
	                       )                       									AS  	STUDENT_NAME
	            ,	SI.GENDER                   									AS  	STUDENT_GENDER
	            ,	GRADES.GRADECD													AS		GRADE_CODE
	            ,	( 
		                 SELECT  
		                       L_ABR_GVAL 
		                 FROM 
		                       GRADE_VAL 
		                 WHERE
		                       GRADECD = GRADES.GRADECD
		              )                         									AS 		GRADE_VAL
	            ,	GRADES.GRADUSRACCTCD
                ,	(
			          SELECT 
			                 DECODE(
                                		COUNT(TN.STDNO)
                                		,0,'N','Y'
                            	)
			          FROM
			                T_STD_INCOMPLETE_GRADE_NOTIFY TN
			          WHERE
			                    
			                    TN.STDSTATCD 	= 	SI.STDSTATCD
			                AND TN.CCYRCD   	=  :paramYear
			                AND TN.SEMCD    	=  :paramSem
				      )  
				                                                         		AS 		RECORD_AVAILABLE   
				 ,(
		                SELECT 
		                      MAX(REC_SEQ_NO)
		                FROM
		                      T_STD_INCOMPLETE_GRADE_NOTIFY TN
		                WHERE
		                          
		                          TN.STDSTATCD = SI.STDSTATCD
		                      AND TN.CCYRCD   =  :paramYear
		                      AND TN.SEMCD    =  :paramSem
		            )                                                     		AS 		SEQUENCE_NUMBER   				                                                         		
			FROM  
					V_STDTIMETABLE_PORTAL 	ST
			    ,	V_STDINFO_PORTAL 		SI 
			    ,	STD_GRADES      		GRADES
			WHERE 
					 		ST.COURSE_CODE		= 	:paramLAbrCourseNo 
					 AND	ST.SECTNO			=	:paramSectionNo 
					 AND	ST.STD_ID			= 	SI.STD_ID 
					 AND	ST.EMPNO			=	:paramEmpNo	
	                 AND	ST.STDNO			=	GRADES.STDNO(+)
	                 AND	ST.COURSE_CODE		=	GRADES.L_ABR_CRSNO (+)
	                 AND	ST.SECTNO			=	GRADES.SECTNO (+)
	                 AND	GRADES.CCYRCD (+) 	= 	:paramYear
		             AND	GRADES.SEMCD (+) 	= 	:paramSem
		             AND 	SI.ACTIVE 			= 	'Y' 
			                  
					 ORDER BY GRADUSRACCTCD DESC, ST.STD_ID	
	</entry>
	<entry key="dps.incomplete.grades.insert.notify.by.instructor">
	INSERT INTO 
	T_STD_INCOMPLETE_GRADE_NOTIFY 
			(
			    REC_SEQ_NO
			  , STDNO
			  , STDSTATCD
			  , CCYRCD
			  , SEMCD
			  , SECTCD
			  , L_ABR_CRSNO
			  , CRSNO
			  , SECTNO
			  , STATUSCD
			
			  , CREATE_DATE
			  , CREATE_USERNAME
			  , COMMENTS
			) 
	VALUES (
	          	:paramSeqenceNum 
	          , :paramStdNo
	          , :paramStdStatCode
	          , :paramYear
	          , :paramSem
	          , :paramSectCode
	          , :paramCourseLAbrCode
	          , :paramCourseNo
	          , :paramSectNo
	          , (
	                   SELECT
	                       CODES.SISCODECD	
	                   FROM
	                           SIS_CODES       CODES
	                       ,   SIS_CODE_TYPES  TYPES
	                   WHERE
	                           CODES.SISCODETYPCD =  TYPES.SISCODETYPCD
	                       AND TYPES.SISCODETYPNM = 'APPROVAL_STATUS'
	                       AND CODES.L_ABR_CODE  = :paramStatusCode		    
	            )
	          , SYSDATE 
	          , :paramUserName
	          , :paramComment
	        )
	
	</entry>
	<entry key="dps.incomplete.grades.select.notify.history">
			SELECT 
              		VSP.STD_ID													AS		STUDENT_ID
		        ,  T_NOTIFY.L_ABR_CRSNO											AS    	L_ABR_CRSNO
		      	,   T_NOTIFY.SECTNO												AS		SECTION_NO

			  	, T_NOTIFY.COMMENTS                                    			AS 		COMMENTS
			  	, (
		        	SELECT
		        		L_ABR_CODE
		        	FROM SIS_CODES
		            WHERE 
		            	SISCODECD= T_NOTIFY.STATUSCD
		        	)															AS		STATUS_CODE_NAME
	        	, (
		            SELECT 
		              DECODE 
		              (
		                :paramLocale
		                ,'en', CODENM, A_CODENM
		                )
		              FROM SIS_CODES
		              WHERE SISCODECD= T_NOTIFY.STATUSCD
	            ) 																AS 		STATUS_DESC
              
		      , FUNC_APPROVE_STATUS(
		                           T_NOTIFY.STDNO,
		                           :paramHodRoleName, 
		                           :paramFormName,
		                           T_NOTIFY.REC_SEQ_NO
		                           )                        					AS  	HOD_STATUS
		     , FUNC_APPROVE_STATUS(
		                     T_NOTIFY.STDNO,
		                     :paramADeanPRoleName, 
		                     :paramFormName,
		                     T_NOTIFY.REC_SEQ_NO
		                     )                              					AS  	DPS_ASST_DEAN_STATUS 
		     , FUNC_APPROVE_STATUS(
		                     T_NOTIFY.STDNO,
		                     :paramDeanPRoleName, 
		                     :paramFormName,
		                     T_NOTIFY.REC_SEQ_NO
		                     )                              					AS  	DPS_DEAN_STATUS  
		                      
              , FUNC_APPROVER_COMMENT(
		                     T_NOTIFY.STDNO,
		                     :paramHodRoleName, 
		                     :paramFormName,
		                     T_NOTIFY.REC_SEQ_NO
		                     )                              					AS  	HOD_COMMENT  
		      , FUNC_APPROVER_COMMENT(
		                     T_NOTIFY.STDNO,
		                     :paramADeanPRoleName, 
		                     :paramFormName,
		                     T_NOTIFY.REC_SEQ_NO
		                     )                              					AS  	DPS_ASST_DEAN_COMMENT  
		      , FUNC_APPROVER_COMMENT(
		                     T_NOTIFY.STDNO,
		                     :paramDeanPRoleName, 
		                     :paramFormName,
		                     T_NOTIFY.REC_SEQ_NO
		                     )                              					AS  	DPS_DEAN_COMMENT         
		FROM
             	 T_STD_INCOMPLETE_GRADE_NOTIFY  		  	T_NOTIFY
		      ,   V_STDINFO_PORTAL    						VSP

          
		WHERE
				T_NOTIFY.REC_SEQ_NO	= :paramSequenceNo	      	
		      	AND T_NOTIFY.STDNO 	= VSP.STDNO
          		AND VSP.ACTIVE    	= 'Y'
       
          
		ORDER BY T_NOTIFY.UPDATE_DATE DESC	
	</entry>

</properties>